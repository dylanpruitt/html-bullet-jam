<!DOCTYPE html>
<html>
    <head>
        <title>The Game</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <style>
            canvas {
                border: 1px solid #d3d3d3;
                background-color: #f1f1f1;
                cursor: none;
            }
        </style>
    </head>
    <body onload="startGame()">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="js/assets.js"></script>
        <script src="js/bullets.js"></script>
        <script src="js/weapons.js"></script>
        <script src="js/tiles.js"></script>
        <script src="js/map.js"></script>
        <script src="js/entity.js"></script>
        <script src="js/render.js"></script>
        <script src="js/game.js"></script>
        <script>
            let loadMap = () => {
                let importedFile = document.getElementById('map-file').files[0];

                let reader = new FileReader();
                reader.onload = function() {
                    let fileContent = JSON.parse(reader.result);
                    console.log(fileContent);
                    spawnX = fileContent.spawnX;
                    player.x = spawnX;
                    spawnY = fileContent.spawnY;
                    player.y = spawnY;
                    MAP_WIDTH = fileContent.MAP_WIDTH;
                    MAP_HEIGHT = fileContent.MAP_HEIGHT;
                    tileArray = fileContent.tiles;
                    for (let i = 0; i < tileArray.length; i++) {
                        tileArray[i].image = new Image();
                        tileArray[i].image.src = tileArray[i].imagePath;
                    }
                    boundingBoxes = fileContent.boxes;
                    entities = fileContent.entities;
                    for (let i = 0; i < entities.length; i++) {
                        let index = getEntityConstructorIndexFromName(entities[i].name);
                        if (index !== -1) {
                            entities[i] = entityConstructors[index](entities[i].x, entities[i].y);
                        }
                    }

                };
                reader.readAsText(importedFile);
                drawMaskContext(game);
            }
        </script>
        <input id="map-file" type="file"></input><br>
    </body>
</html>